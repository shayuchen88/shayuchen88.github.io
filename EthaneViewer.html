<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Ethane Conformation Viewer</title>
  <script src="https://3Dmol.org/build/3Dmol-min.js"></script>
  <style>
    body { 
      font-family: Arial, sans-serif; 
      text-align: center; 
      background-color: #ffffff; 
      margin: 0; 
      padding: 0;
    }
    #viewer-container {
      width: 80%;
      max-width: 600px;
      aspect-ratio: 1 / 1;   /* 保持正方形 */
      margin: 20px auto;
      border: 1px solid #ffffff;
      position: relative;    /* 确保 canvas 在容器内 */
    }
    input[type=range] { width: 80%; margin-top: 10px; }
    button { margin: 5px; padding: 5px 15px; }
  </style>
</head>
<body>
  <h2>Ethane Conformation Viewer</h2>
  <div id="viewer-container"></div>

  <label for="angleRange">Dihedral Angle: <span id="angleValue">0</span>°</label><br />
  <input type="range" id="angleRange" min="0" max="360" value="0" />

  <br>
  <button id="staggeredBtn">Staggered</button>
  <button id="eclipsedBtn">Eclipsed</button>

  <script>
    window.addEventListener('DOMContentLoaded', () => {
      const element = document.getElementById('viewer-container');
      const viewer = $3Dmol.createViewer(element, { backgroundColor: 'white' });

      const baseAtoms = [
  { elem: 'C', x: -0.7560, y: 0.0000, z: 0.0000, bonds: [1,2,3,4] }, // 左 C
  { elem: 'C', x:  0.7560, y: 0.0000, z: 0.0000, bonds: [0,5,6,7] }, // 右 C
  { elem:'H', x:-1.1404, y: 0.6586, z: 0.7845, bonds:[0] },          // 左红 H
  { elem:'H', x:-1.1404, y: 0.3501, z:-0.9626, bonds:[0] },          // 左 H
  { elem:'H', x:-1.1405, y:-1.0087, z: 0.1781, bonds:[0] },          // 左 H
  { elem:'H', x: 1.1404, y: 0.6586, z: 0.7845, bonds:[1] },          // 右 H1（旋转后）
  { elem:'H', x: 1.1404, y: 0.3501, z:-0.9626, bonds:[1] },          // 右红 H2（旋转后）
  { elem:'H', x: 1.1404, y:-1.0087, z: 0.1781, bonds:[1] }           // 右 H3（旋转后）
];

      function drawEthane(angleDeg) {
        viewer.removeAllModels();
        const model = viewer.addModel();
        const theta = (angleDeg * Math.PI) / 180;
        const cosT = Math.cos(theta);
        const sinT = Math.sin(theta);

        const atoms = baseAtoms.map((a, i) => {
          if (i <= 4) return { ...a }; // 左侧 C 和 H 不动
          // 右侧 H 绕 C-C 键旋转 (x轴)
          const rel = { x: a.x - 0.7560, y: a.y, z: a.z };
          const ry = rel.y * cosT - rel.z * sinT;
          const rz = rel.y * sinT + rel.z * cosT;
          return { elem: a.elem, x: rel.x + 0.7560, y: ry, z: rz, bonds: a.bonds };
        });

        model.addAtoms(atoms);
        model.setStyle({}, { stick: { radius: 0.2 }, sphere: { radius: 0.3, colorscheme: "Jmol"}});
        viewer.zoomTo();
        viewer.render();
      }

      const angleInput = document.getElementById('angleRange');
      const angleLabel = document.getElementById('angleValue');

      // 滑条控制
      angleInput.addEventListener('input', () => {
        const val = parseFloat(angleInput.value);
        angleLabel.textContent = val;
        drawEthane(val);
      });

      // 按钮控制
      document.getElementById('staggeredBtn').addEventListener('click', () => {
        angleInput.value = 60;
        angleLabel.textContent = 60;
        drawEthane(60);
      });

      document.getElementById('eclipsedBtn').addEventListener('click', () => {
        angleInput.value = 0;
        angleLabel.textContent = 0;
        drawEthane(0);
      });

      // 初始化显示
      drawEthane(0);

      // 窗口大小变化时自动调整
      window.addEventListener('resize', () => {
        viewer.resize();
        viewer.render();
      });
    });
  </script>
</body>
</html>





